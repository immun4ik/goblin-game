(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}function i(t){var i=function(t){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(i)?i:i+""}var n=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gridSize=t,this.cells=[],this.activeCellIndex=-1,this.boardElement=document.getElementById("game-board"),!this.boardElement)throw new Error("Game board element not found!");this.createBoard()},(i=[{key:"createBoard",value:function(){this.boardElement.innerHTML="";for(var e=0;e<this.gridSize*this.gridSize;e++){var t=document.createElement("div");t.classList.add("cell"),t.dataset.index=e,this.cells.push(t),this.boardElement.append(t)}}},{key:"placeGoblin",value:function(){var e;this.removeGoblin();do{e=Math.floor(Math.random()*this.cells.length)}while(e===this.activeCellIndex);this.activeCellIndex=e;var t=this.cells[this.activeCellIndex],i=document.createElement("div");return i.classList.add("goblin","active"),t.append(i),this.activeCellIndex}},{key:"removeGoblin",value:function(){if(-1!==this.activeCellIndex){var e=this.cells[this.activeCellIndex].querySelector(".goblin");e&&e.remove(),this.activeCellIndex=-1}}},{key:"hasGoblin",value:function(e){return null!==e.querySelector(".goblin.active")}},{key:"getCells",value:function(){return this.cells}}])&&t(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i}();function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,r(n.key),n)}}function r(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}var a=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.score=0,this.missedCount=0,this.maxMissed=5,this.gameTimeoutId=null,this.goblinAppearanceDuration=1e3,this.board=new n,this.scoreElement=document.getElementById("score"),this.missedElement=document.getElementById("missed"),this.messageElement=document.getElementById("game-message"),this.restartButton=document.getElementById("restart-button"),this.initListeners(),this.updateUI()},(t=[{key:"initListeners",value:function(){var e=this;this.board.getCells().forEach(function(t){t.addEventListener("click",e.handleCellClick.bind(e))}),this.restartButton.addEventListener("click",this.startGame.bind(this))}},{key:"startGame",value:function(){this.score=0,this.missedCount=0,this.updateUI(),this.messageElement.textContent="",this.restartButton.classList.add("hidden"),this.gameTimeoutId&&(clearTimeout(this.gameTimeoutId),this.gameTimeoutId=null),this.board.placeGoblin(),this.scheduleNextGoblinMove(),console.log("Game Started!")}},{key:"endGame",value:function(){this.gameTimeoutId&&(clearTimeout(this.gameTimeoutId),this.gameTimeoutId=null),this.board.removeGoblin(),this.messageElement.textContent="Game Over! You missed ".concat(this.maxMissed," goblins.Your score: ").concat(this.score,"."),this.restartButton.classList.remove("hidden"),console.log("Game Over!")}},{key:"scheduleNextGoblinMove",value:function(){var e=this;this.gameTimeoutId&&clearTimeout(this.gameTimeoutId),this.gameTimeoutId=setTimeout(function(){e.moveGoblin()},this.goblinAppearanceDuration)}},{key:"moveGoblin",value:function(){-1!==this.board.activeCellIndex&&this.handleMiss(),this.missedCount>=this.maxMissed?this.endGame():(this.board.placeGoblin(),this.scheduleNextGoblinMove())}},{key:"handleCellClick",value:function(e){var t=e.currentTarget;this.gameTimeoutId&&(this.board.hasGoblin(t)?(this.handleHit(),this.board.removeGoblin(),this.missedCount<this.maxMissed?(this.board.placeGoblin(),this.scheduleNextGoblinMove()):this.endGame()):this.handleMiss())}},{key:"handleHit",value:function(){this.score++,this.updateUI(),console.log("Hit! Score:",this.score)}},{key:"handleMiss",value:function(){this.missedCount++,this.updateUI(),console.log("Miss! Missed:",this.missedCount),this.missedCount>=this.maxMissed&&this.endGame()}},{key:"updateUI",value:function(){this.scoreElement.textContent=this.score,this.missedElement.textContent="".concat(this.missedCount," / ").concat(this.maxMissed)}}])&&s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();document.addEventListener("DOMContentLoaded",function(){(new a).startGame()})})();